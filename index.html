<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MHChat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* This is a simple, custom stylesheet for the app */
        body {
            font-family: 'Roboto Mono', monospace;
            background-color: #000000;
            color: #00ff00;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 1.25rem;
            overflow: hidden;
        }

        /* Custom animation for the blinking cursor effect */
        @keyframes blink {
            50% { opacity: 0; }
        }
        .blinking-cursor::after {
            content: '_';
            animation: blink 1s step-end infinite;
        }

        /* Custom scrollbar for a themed look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0a0a0a;
        }
        ::-webkit-scrollbar-thumb {
            background: #00ff00;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #00cc00;
        }

        /* Responsive sidebar for mobile view */
        #sidebar.mobile-open {
            display: flex;
            transform: translateX(0);
        }

        @media (max-width: 767px) {
            #sidebar {
                position: absolute;
                top: 0;
                left: 0;
                height: 100%;
                z-index: 50;
                transform: translateX(-100%);
                transition: transform 0.3s ease-in-out;
            }
            #main-chat-screen {
                flex-direction: column;
            }
        }
    </style>
</head>
<body class="bg-black text-green-500 font-mono">

    <!-- IMPORTANT: This is a static demo. All data is stored in memory and will be lost on page refresh. -->

    <!-- Main Application Container that manages screen views -->
    <div id="app-container" class="flex justify-center items-center min-h-screen p-5">
        
        <!-- Main Chat Screen -->
        <div id="main-chat-screen" class="screen w-full max-w-5xl h-[85vh] flex flex-col md:flex-row bg-[#0a0a0a] border-2 border-green-500 shadow-[0_0_20px_#00ff00] rounded-md overflow-hidden">
            
            <!-- Sidebar for contacts and groups -->
            <div id="sidebar" class="w-full md:w-1/3 hidden md:flex flex-col p-4 overflow-y-auto">
                <div class="text-center font-bold text-lg mb-4">
                    MHChat
                    <span id="current-user-id-display" class="font-normal text-xs text-gray-400 block break-all mt-1"></span>
                </div>
                
                <div class="flex flex-col gap-2 mb-4">
                    <button id="add-contact-btn" class="flex-grow p-2 bg-[#002200] border-2 border-green-500 rounded-md hover:shadow-[0_0_8px_#00ff00]">New Contact</button>
                    <button id="create-group-btn" class="flex-grow p-2 bg-[#002200] border-2 border-green-500 rounded-md hover:shadow-[0_0_8px_#00ff00]">New Group</button>
                    <button id="settings-btn" class="flex-grow p-2 bg-[#002200] border-2 border-green-500 rounded-md hover:shadow-[0_0_8px_#00ff00]">Settings</button>
                </div>

                <div id="contact-list" class="flex-grow flex flex-col gap-2">
                    <div class="text-xs text-gray-500">CONVERSATIONS</div>
                    <!-- Conversation items will be added here dynamically -->
                </div>
            </div>

            <!-- Main chat window -->
            <div id="chat-window-container" class="flex-grow flex flex-col w-full">
                <div id="chat-header" class="p-4 bg-[#1a1a1a] border-b-2 border-green-500 text-center font-bold flex items-center gap-4">
                    <button id="menu-btn" class="md:hidden p-1 rounded-md hover:bg-[#002200]">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                    <span id="chat-header-text" class="flex-grow text-center">No Conversation Selected</span>
                </div>

                <div id="chat-window" class="flex-grow p-8 overflow-y-auto flex flex-col gap-4 whitespace-pre-wrap">
                    <!-- Messages will be added here dynamically -->
                </div>

                <form id="chat-input-form" class="flex p-4 gap-2 border-t-2 border-green-500">
                    <textarea
                        id="chat-user-input"
                        rows="1"
                        placeholder=">_ Type your message..."
                        class="flex-grow text-base bg-black placeholder-gray-400 focus:ring-green-500 focus:border-green-500 border-green-500 resize-none rounded-md p-2 transition-all duration-200"
                    ></textarea>
                    <button
                        type="submit"
                        id="chat-send-btn"
                        class="bg-green-500 text-black font-bold py-2 px-4 rounded-md cursor-pointer transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed hover:shadow-[0_0_15px_#00ff00]"
                        disabled
                    >
                        Send
                    </button>
                </form>
            </div>
        </div>

        <!-- Add Contact Screen -->
        <div id="add-contact-screen" class="screen w-full max-w-5xl h-[85vh] hidden flex-col justify-center items-center bg-[#0a0a0a] border-2 border-green-500 shadow-[0_0_20px_#00ff00] rounded-md p-8">
            <div class="w-full max-w-md">
                <h2 class="text-xl font-bold mb-4 text-center">Add New Contact</h2>
                <p class="text-sm text-gray-400 mb-2">Enter the full user ID:</p>
                <input type="text" id="contact-id-input" placeholder="Enter User ID" class="w-full p-2 bg-black border border-green-500 rounded-md mb-2">
                <p class="text-sm text-gray-400 mb-2">Give a nickname (optional):</p>
                <input type="text" id="contact-alias-input" placeholder="Nickname" class="w-full p-2 bg-black border border-green-500 rounded-md mb-4">
                <p id="contact-search-result" class="mt-4 hidden text-center"></p>
                <div class="flex justify-end gap-2 mt-4">
                    <button id="cancel-contact-btn" class="p-2 bg-gray-700 rounded-md">Cancel</button>
                    <button id="add-contact-submit-btn" class="p-2 bg-green-500 text-black font-bold rounded-md">Add</button>
                </div>
            </div>
        </div>

        <!-- Create Group Screen -->
        <div id="create-group-screen" class="screen w-full max-w-5xl h-[85vh] hidden flex-col justify-center items-center bg-[#0a0a0a] border-2 border-green-500 shadow-[0_0_20px_#00ff00] rounded-md p-8">
            <div class="w-full max-w-md">
                <h2 class="text-xl font-bold mb-4 text-center">Create New Group</h2>
                <input type="text" id="group-name-input" placeholder="Group Name" class="w-full p-2 bg-black border border-green-500 rounded-md mb-4">
                <div id="contact-selection-list" class="flex flex-col gap-2 max-h-40 overflow-y-auto mb-4 border border-green-500 p-2 rounded-md">
                    <!-- Contacts will be dynamically added here -->
                </div>
                <p id="group-error-message" class="text-red-500 mt-4 hidden text-center"></p>
                <div class="flex justify-end gap-2 mt-4">
                    <button id="cancel-group-btn" class="p-2 bg-gray-700 rounded-md">Cancel</button>
                    <button id="create-group-submit-btn" class="p-2 bg-green-500 text-black font-bold rounded-md">Create Group</button>
                </div>
            </div>
        </div>

        <!-- Settings Screen -->
        <div id="settings-screen" class="screen w-full max-w-5xl h-[85vh] hidden flex-col justify-center items-center bg-[#0a0a0a] border-2 border-green-500 shadow-[0_0_20px_#00ff00] rounded-md p-8">
            <div class="w-full max-w-md">
                <h2 class="text-xl font-bold mb-4 text-center">Settings</h2>
                <p class="text-sm text-gray-400 mb-2">Current User ID: <span id="settings-user-id-display" class="font-bold break-all"></span></p>
                <p class="text-sm text-gray-400 mb-2">Change your display name:</p>
                <input type="text" id="display-name-input" placeholder="New Display Name" class="w-full p-2 bg-black border border-green-500 rounded-md mb-4">
                <div class="flex justify-end gap-2 mt-4">
                    <button id="cancel-settings-btn" class="p-2 bg-gray-700 rounded-md">Cancel</button>
                    <button id="save-name-btn" class="p-2 bg-green-500 text-black font-bold rounded-md">Save</button>
                </div>
            </div>
        </div>

        <!-- Custom Confirmation Modal -->
        <div id="delete-confirm-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex justify-center items-center z-50">
            <div class="bg-[#0a0a0a] p-8 rounded-md border-2 border-green-500 max-w-sm w-full text-center">
                <p id="modal-text" class="mb-4">Are you sure you want to delete this conversation?</p>
                <div class="flex justify-center gap-4">
                    <button id="modal-cancel-btn" class="p-2 bg-gray-700 rounded-md">Cancel</button>
                    <button id="modal-confirm-btn" class="p-2 bg-red-500 text-black font-bold rounded-md">Delete</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // --- IMPORTANT: Static JavaScript Logic ---
        // This is a front-end demo. All data is stored in memory and will be lost on page refresh.

        document.addEventListener('DOMContentLoaded', () => {

            // --- UI Elements ---
            const screens = {
                mainChat: document.getElementById('main-chat-screen'),
                addContact: document.getElementById('add-contact-screen'),
                createGroup: document.getElementById('create-group-screen'),
                settings: document.getElementById('settings-screen')
            };
            const currentUserIdDisplay = document.getElementById('current-user-id-display');
            const chatWindow = document.getElementById('chat-window');
            const chatHeaderText = document.getElementById('chat-header-text');
            const chatUserInput = document.getElementById('chat-user-input');
            const chatInputForm = document.getElementById('chat-input-form');
            const chatSendBtn = document.getElementById('chat-send-btn');
            const contactListDiv = document.getElementById('contact-list');
            const addContactBtn = document.getElementById('add-contact-btn');
            const createGroupBtn = document.getElementById('create-group-btn');
            const settingsBtn = document.getElementById('settings-btn');
            const menuBtn = document.getElementById('menu-btn');
            const sidebar = document.getElementById('sidebar');

            const contactIdInput = document.getElementById('contact-id-input');
            const contactAliasInput = document.getElementById('contact-alias-input');
            const addContactSubmitBtn = document.getElementById('add-contact-submit-btn');
            const contactSearchResult = document.getElementById('contact-search-result');

            const groupNameInput = document.getElementById('group-name-input');
            const contactSelectionList = document.getElementById('contact-selection-list');
            const createGroupSubmitBtn = document.getElementById('create-group-submit-btn');
            const groupErrorMsg = document.getElementById('group-error-message');

            const settingsUserIdDisplay = document.getElementById('settings-user-id-display');
            const displayNameInput = document.getElementById('display-name-input');
            const saveNameBtn = document.getElementById('save-name-btn');
            const backButtons = document.querySelectorAll('[id^="cancel-"]');

            const deleteConfirmModal = document.getElementById('delete-confirm-modal');
            const modalText = document.getElementById('modal-text');
            const modalCancelBtn = document.getElementById('modal-cancel-btn');
            const modalConfirmBtn = document.getElementById('modal-confirm-btn');

            // --- In-memory Data Store ---
            // This data will be reset every time the page is refreshed.
            let currentUser = {
                uid: "user-" + Math.random().toString(36).substring(2, 10), // A random, unique ID for the demo
                displayName: "Guest User"
            };
            let conversations = [{ id: "mystic-hero-bot", alias: "MysticHero", type: "contact" }];
            let activeConversationId = null;
            let conversationToDelete = null;

            // --- Core Functions ---

            // A simple UUID generator for contacts and groups
            function generateId() {
                return Math.random().toString(36).substring(2, 12);
            }

            // Switches between the different app screens
            function showScreen(screenId) {
                Object.values(screens).forEach(screen => {
                    screen.classList.add('hidden');
                });
                screens[screenId].classList.remove('hidden');
            }

            // Adds a message to the chat window
            function addMessage(text, isMyMessage) {
                const messageElement = document.createElement('div');
                messageElement.classList.add('p-4', 'rounded-md', 'border-l-2', 'max-w-full', 'whitespace-pre-wrap');
                
                // Apply styling based on who sent the message
                if (isMyMessage) {
                    messageElement.classList.add('self-end', 'bg-[#002200]', 'border-green-500');
                } else {
                    messageElement.classList.add('self-start', 'bg-[#001100]', 'border-green-500');
                }

                // Get display name based on message sender (simulated)
                const senderName = isMyMessage ? currentUser.displayName : chatHeaderText.textContent;
                messageElement.textContent = `${senderName}> ${text}`;

                chatWindow.appendChild(messageElement);
                chatWindow.scrollTop = chatWindow.scrollHeight;
            }

            // Renders the list of conversations in the sidebar
            function renderSidebar() {
                contactListDiv.innerHTML = '<div class="text-xs text-gray-500 mb-2">CONVERSATIONS</div>';
                currentUserIdDisplay.textContent = `${currentUser.displayName} [${currentUser.uid.substring(0, 8)}...]`;

                conversations.forEach(convo => {
                    const convoItem = document.createElement('div');
                    convoItem.classList.add('flex', 'items-center', 'justify-between', 'gap-2');
                    
                    const convoButton = document.createElement('button');
                    convoButton.textContent = convo.type === 'group' ? `GROUP: ${convo.alias}` : convo.alias;
                    convoButton.classList.add('flex-grow', 'p-2', 'bg-[#002200]', 'border', 'border-green-500', 'rounded-md', 'text-left', 'hover:bg-[#003300]', 'transition-colors');
                    convoButton.onclick = () => selectConversation(convo.id, convo.alias, convo.type);
                    
                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'x';
                    deleteButton.classList.add('p-1', 'bg-red-500', 'text-black', 'rounded-md', 'hover:bg-red-700', 'transition-colors');
                    deleteButton.onclick = (e) => {
                        e.stopPropagation(); // Prevent selecting the conversation
                        showDeleteModal(convo.id, convo.alias);
                    };

                    convoItem.appendChild(convoButton);
                    if (convo.id !== "mystic-hero-bot") { // Prevent deleting the bot
                        convoItem.appendChild(deleteButton);
                    }
                    contactListDiv.appendChild(convoItem);
                });
            }

            // Shows the custom delete confirmation modal
            function showDeleteModal(id, alias) {
                conversationToDelete = id;
                modalText.textContent = `Are you sure you want to delete "${alias}"?`;
                deleteConfirmModal.classList.remove('hidden');
            }

            // Deletes a conversation from the list
            function deleteConversation(id) {
                conversations = conversations.filter(convo => convo.id !== id);
                renderSidebar();
                if (activeConversationId === id) {
                    activeConversationId = null;
                    chatHeaderText.textContent = 'No Conversation Selected';
                    chatWindow.innerHTML = '';
                }
            }

            // Selects a conversation and updates the chat header
            function selectConversation(id, title, type) {
                activeConversationId = id;
                chatHeaderText.textContent = type === 'group' ? `GROUP: ${title}` : title;
                chatWindow.innerHTML = ''; // Clear chat window for the new conversation

                // Add a welcome message to the bot chat
                if (id === 'mystic-hero-bot') {
                    const welcomeMessage = document.createElement('div');
                    welcomeMessage.textContent = 'You are now talking to MysticHero. They will listen, but they will not speak.';
                    welcomeMessage.classList.add('text-center', 'text-gray-500', 'italic', 'mb-4');
                    chatWindow.appendChild(welcomeMessage);
                }

                // Close sidebar on mobile
                if (window.innerWidth < 767) {
                    sidebar.classList.remove('mobile-open', 'flex');
                    sidebar.classList.add('hidden');
                }
            }

            // Handles sending a message
            function handleSendMessage(e) {
                e.preventDefault();
                const messageText = chatUserInput.value.trim();
                if (!messageText) return;

                addMessage(messageText, true);

                // Special logic for the bot
                if (activeConversationId === "mystic-hero-bot") {
                    // MysticHero does not reply
                }

                chatUserInput.value = '';
                chatSendBtn.disabled = true;
            }

            // --- Event Listeners ---

            // Enable/disable the send button based on input content
            chatUserInput.addEventListener('input', () => {
                chatSendBtn.disabled = !chatUserInput.value.trim();
            });

            // Handle form submission
            chatInputForm.addEventListener('submit', handleSendMessage);

            // Add Contact button click
            addContactBtn.addEventListener('click', () => {
                contactIdInput.value = '';
                contactAliasInput.value = '';
                contactSearchResult.classList.add('hidden');
                showScreen('addContact');
            });

            // Handle Add Contact form submission
            addContactSubmitBtn.addEventListener('click', () => {
                const contactId = contactIdInput.value.trim() || generateId();
                const contactAlias = contactAliasInput.value.trim() || `User ${contactId.substring(0, 8)}`;
                conversations.push({ id: contactId, alias: contactAlias, type: "contact" });
                contactSearchResult.textContent = `Contact '${contactAlias}' added!`;
                contactSearchResult.classList.remove('hidden');
                renderSidebar();
                setTimeout(() => showScreen('mainChat'), 2000);
            });

            // Create Group button click
            createGroupBtn.addEventListener('click', () => {
                contactSelectionList.innerHTML = '';
                const contactsOnly = conversations.filter(c => c.type === 'contact');
                contactsOnly.forEach(contact => {
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.value = contact.id;
                    checkbox.id = `contact-${contact.id}`;
                    checkbox.classList.add('mr-2');
                    const label = document.createElement('label');
                    label.textContent = contact.alias;
                    label.htmlFor = `contact-${contact.id}`;
                    const div = document.createElement('div');
                    div.appendChild(checkbox);
                    div.appendChild(label);
                    contactSelectionList.appendChild(div);
                });
                groupNameInput.value = '';
                groupErrorMsg.classList.add('hidden');
                showScreen('createGroup');
            });

            // Handle Create Group form submission
            createGroupSubmitBtn.addEventListener('click', () => {
                const groupName = groupNameInput.value.trim();
                if (!groupName) {
                    groupErrorMsg.textContent = "Please enter a group name.";
                    groupErrorMsg.classList.remove('hidden');
                    return;
                }
                const groupId = generateId();
                conversations.push({ id: groupId, alias: groupName, type: "group" });
                renderSidebar();
                showScreen('mainChat');
            });

            // Settings button click
            settingsBtn.addEventListener('click', () => {
                settingsUserIdDisplay.textContent = currentUser.uid;
                displayNameInput.value = currentUser.displayName;
                showScreen('settings');
            });

            // Save Display Name in Settings
            saveNameBtn.addEventListener('click', () => {
                const newDisplayName = displayNameInput.value.trim();
                if (newDisplayName) {
                    currentUser.displayName = newDisplayName;
                    renderSidebar();
                }
                showScreen('mainChat');
            });

            // Universal back buttons
            backButtons.forEach(button => {
                button.addEventListener('click', () => {
                    showScreen('mainChat');
                });
            });

            // Menu button for mobile sidebar
            menuBtn.addEventListener('click', () => {
                sidebar.classList.toggle('hidden');
                sidebar.classList.toggle('flex');
                sidebar.classList.toggle('mobile-open');
            });

            // Modal button event listeners
            modalCancelBtn.addEventListener('click', () => {
                deleteConfirmModal.classList.add('hidden');
                conversationToDelete = null;
            });
            modalConfirmBtn.addEventListener('click', () => {
                if (conversationToDelete) {
                    deleteConversation(conversationToDelete);
                    deleteConfirmModal.classList.add('hidden');
                    conversationToDelete = null;
                }
            });

            // Initial setup on page load
            renderSidebar();
            showScreen('mainChat');
        });
    </script>
</body>
</html>
